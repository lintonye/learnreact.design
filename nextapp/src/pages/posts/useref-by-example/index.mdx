import { ConvertKitForm } from '@/components/design-system'
export const meta = {
  title: 'useRef By Example',
  description: `React is a JavaScript library for building user interfaces. This is the official definition of React. But what if you are not familiar with JavaScript? What if you are not a developer? Would you still be able to make sense of (and learn) React? My answer is a firm YES. `,
  date: '2021-02-25',
  tags: ['react'],
  related: ['what-is-react-native', 'what-is-redux'],
  ogImage: {
    // url: imgSocialCard,
    width: 1280,
    height: 720,
  },
  // surprise: {
  //   actor: () => <Image src={imgSurprise} width={145} height={145} />,
  //   animationVariants: {
  //     hidden: { x: -10, rotate: 0, y: 40 },
  //     revealed: { x: -150, rotate: 0, y: 40 },
  //   },
  // },
}

<!--excerpt-->

"React is a JavaScript library for building user interfaces." This is the official definition. But what if you are not familiar with JavaScript? Would you still be able to make sense of (and learn) React? My answer is a firm YES.

<!--/excerpt-->

## Introduction

`useRef` is one of the built-in React Hooks. It is also, at least in my experience, one of the most confusing Hooks (perhaps right after `useEffect`)(agree? +1 TODO). But it's actually a hidden gem ðŸ’Ž. With a good understanding of how it works, it'll become a powerful tool in our arsenal.

What is `useRef` used for? There are two use cases:

1. **Directly access DOM nodes.** When combined with the `ref` attribute, we could use `useRef` to obtain the underlying DOM nodes to perform DOM operations imperatively. In fact, we should only do this sparsely for things like setting focus, measuring DOM nodes or animations. If we use it for everything (in theory we could), we'd lose the benefit of [React's declarative programming paradigm](TODO).
2. **Persist values across re-renders.** This is what I'm going to focus on in this article.

I'll reveal this shiny gem <span className="mr-2">ðŸ’Ž</span> for you in three steps: 1) its mental model, 2) a couple of simple examples, and finally 3) a real-world example -- the like button below (click and hold for additional fun).

TODO like button

## The mental model

> `useRef` is like class instance variable for function components.

This single sentence is what made `useRef` click for me. If it has the same effect on you, feel free to skip to [the examples section](TODO). Otherwise, if you are not familiar JavaScript classes or class instance variables, read on.

### `ref` and `useRef`

As mentioned, we could use the `ref` attribute and `useRef` to obtain the access to underlying DOM nodes, like so:

```jsx
function Editor() {
  // 1. Call useRef
  const textboxRef = useRef()
  const handleClick = () => {
    // 2. Access the DOM node via ref.current
    textboxRef.current.focus()
  }
  return (
    <div>
      {/* 3. "Bind" the ref with the input */}
      <input type="text" ref={textboxRef} />
      <button onClick={handleClick}>Focus</button>
    </div>
  )
}
```

But, have you wondered how it works?

### The recurring rendering cycles

### Component instance

ref attribute

Class: instance variable

compare with useState: Persist value across re-renders, doesn't trigger re-render

An illustration
usually use with useEffect

<div className="p-8 bg-yellow-100 border border-yellow-400 rounded-sm space-y-4 my-2">
  <p>
    I'm working on a book/course that uses similar approach to teach React -- focus on mental models instead of steps and howtos.
    focus on why, not just how.
  </p>
  <p>
    I believe you'd be able to do useful work with React after a few days of
    learning, <strong>even if you are new to coding</strong>. If you are interested, sign
    up and I'll let you know when the course is ready!
  </p>

  <ConvertKitForm formId="467678" subscribeButtonTitle="Keep Me Posted" />
</div>

## Example 1: previous value / state

```jsx
function Counter() {
  const [count, setCount] = useState(0)
  const prevCount = useRef()
  useEffect(() => {
    prevCount.current = count
  })

  return (
    <div className="App">
      <h1>
        Prev:{prevCount.current}, Count: {count}
      </h1>
      <button onClick={() => setCount((c) => c + 1)}>+1</button>
    </div>
  )
}
```

https://codesandbox.io/s/useref-previous-state-hmthe

## Example 2: stop watch (clear interval)

https://codesandbox.io/s/useref-cancelable-interval-uljky?file=/src/App.js

## Example 3: usePressHoldRepeat

https://codesandbox.io/s/useref-usepressholdrepeat-7megx

## Example 4: useDebouncedState

## Anti-patterns

assign to current in render
use current in jsx

## Misc.

"What is the difference between useRef and createRef?"

## Conclusion

When combined with `useEffect`, `useState` and `useCallback`, `useRef` turns out to be a powerful tool.
Other examples? Let me know
