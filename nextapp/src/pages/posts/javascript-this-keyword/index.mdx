import { ConvertKitForm } from '@/components/design-system'
import { LiveEditor, CodeViewer } from '@/components/LiveEditor'
import { useForceRender } from '@/components/useref-by-example/useForceRender'
// import { UseRefSurprise } from '@/components/useref-by-example/UseRefSurprise'
// import { Demo } from '@/components/Demo'
import { Reactions } from '@/components/Reactions'
import { NoticeBox } from '@/components/NoticeBox'
// import imgTimeLoop from './time-loop.jpeg'
// import imgSocialCard from './useref-social-card.png'
import { FiInfo } from 'react-icons/fi'

export const meta = {
  title: `"this" Is Weird: Understanding JavaScript's "this" Keyword`,
  description: `The React.useRef Hook is used for referencing DOM nodes and persisting a mutalbe value across rerenders. This is an interactive guide to useRef with real-world examples.`,
  date: '2021-04-10',
  tags: ['javascript'],
  related: [
    'react-mental-model-cut-holes-in-html-template',
    'react-mental-model-html-input',
    'react-mental-model-jsx',
  ],
  ogImage: {
    // url: imgSocialCard,
    width: 1280,
    height: 720,
  },
  // surprise: {
  //   actor: (revealEnded) => <UseRefSurprise autoPlay={revealEnded} />,
  //   animationVariants: {
  //     hidden: { x: 0, rotate: 0, y: 60 },
  //     revealed: { x: -100, rotate: 0, y: 60 },
  //   },
  // },
}

<!--excerpt-->

The `this` keyword in JavaScript behaves differently than similar constructs in other languages.

<!--/excerpt-->

The `this` keyword is a fundamental concept in JavaScript. However its behavior is different from smiliar constructs in other languages. The behavior is often very surprising especially if you are familiar with `this` in Java, or `self` in Python or Ruby [^1].

Take this React class component[^2] as an example:

```jsx
class MyComponent {
  constructor() {
    this.state = { count: 0 }
  }
  handleClick() {
    this.setState({ count: count + 1 })
  }
  render() {
    return <button onClick={this.handleClick}>{count}</button>
  }
}
```

The code looks alright, right? But if you click the button, you'll get an error:

```
setState is not a function TODO accurate error message
```

Isn't `handleClick` a method of class `MyComponent`? Why is the value of `this` is `undefined`? Isn't it supposed to be the current class instance?

**_This is weird!_**

In this post, let's take a quick tour of how `this` works in JavaScript, and most importantly, why does it work that way (TODO should we cover this?)!

[^1]: My own story here. I've been struggled with `this` in JavaScript for so long. That's precisely because I've been working as a Java developer for a few years. You don't know what you don't know.
[^2]: I know, these days we don't write that many class components in React anymore. But it's still useful to understand class components since you'll typically see them in legacy code. Not everyone has the time to rewrite all class components as function components.

<NoticeBox title='Intended audience'>

This article assumes that you are familiar with [React](/posts/components-props-state) [basics](/posts/react-mental-model-cut-holes-in-html-template), as well as how to use the `useState` and `useEffect` hooks.

</NoticeBox>

## `this` is determined at runtime

---

```jsx
class MyComponent {
  constructor() {
    this.state = { count: 0 }
  }
  handleClick = () => {
    this.setState({ count: count + 1 })
  }
  render() {
    return <button onClick={handleClick}>{count}</button>
  }
}
```
